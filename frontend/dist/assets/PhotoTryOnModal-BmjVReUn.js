import{j as e,m as s,X as t,D as a,Z as r,ab as l,A as i,J as n,l as o,ac as c,a2 as d,W as m}from"./vendor-ui-DQARcV5T.js";import{r as x}from"./vendor-react-CLKTprKu.js";import{u as h}from"./index-B_NMLkog.js";import{z as u,Z as p,W as g}from"./vendor-ar-CQ8MbuXN.js";import{T as j,I as y}from"./vendor-three-D8-qaPKY.js";const f=({wardrobeItem:i,onCapture:n})=>{const[o,c]=x.useState(!1),[d,m]=x.useState(!0),h=x.useRef(null),g=x.useRef(null),[f,b]=x.useState(!1),[N,v]=x.useState(null);x.useEffect(()=>{if(null==i?void 0:i.imageUrl){const e=new j;y.crossOrigin="anonymous";const s="https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400";e.load(s,e=>{g.current=e,b(!0),v(null)},void 0,s=>{v("Failed to load item image. Using a placeholder instead."),e.load("https://images.pexels.com/photos/1462637/pexels-photo-1462637.jpeg?auto=compress&cs=tinysrgb&w=400",e=>{g.current=e,b(!0),v(null)})})}return()=>{g.current&&g.current.dispose()}},[i]);const w=()=>f&&i?e.jsxs("group",{children:["Accessories"===i.category&&e.jsxs(e.Fragment,{children:[(i.name.toLowerCase().includes("glasses")||i.name.toLowerCase().includes("sunglasses"))&&e.jsxs("mesh",{position:[0,.03,.08],children:[e.jsx("planeGeometry",{args:[.12,.05]}),e.jsx("meshBasicMaterial",{map:g.current,transparent:!0,opacity:.9})]}),(i.name.toLowerCase().includes("hat")||i.name.toLowerCase().includes("cap"))&&e.jsxs("mesh",{position:[0,.08,-.02],rotation:[.3,0,0],children:[e.jsx("planeGeometry",{args:[.15,.1]}),e.jsx("meshBasicMaterial",{map:g.current,transparent:!0,opacity:.9})]})]}),("Tops"===i.category||"Outerwear"===i.category)&&e.jsxs("mesh",{position:[0,-.15,.05],children:[e.jsx("planeGeometry",{args:[.2,.25]}),e.jsx("meshBasicMaterial",{map:g.current,transparent:!0,opacity:.9})]})]}):null;return e.jsxs("div",{className:"relative",children:[d&&e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 z-10 bg-black/70 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"AR Try-On Tips"}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-500 hover:text-gray-700",children:e.jsx(t,{size:20})})]}),e.jsxs("ul",{className:"space-y-2 text-gray-700 mb-4",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-green-100 text-green-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5",children:"1"}),e.jsx("span",{children:"Position your face in the center of the screen"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-green-100 text-green-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5",children:"2"}),e.jsx("span",{children:"Ensure good lighting for best results"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-green-100 text-green-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5",children:"3"}),e.jsx("span",{children:"Try different angles to see how the item looks"})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"bg-green-100 text-green-800 rounded-full w-5 h-5 flex items-center justify-center mr-2 mt-0.5",children:"4"}),e.jsx("span",{children:"Tap the camera button to capture your look"})]})]}),e.jsx("button",{onClick:()=>m(!1),className:"w-full py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all",children:"Got it, let's try on!"})]})}),e.jsxs("div",{className:"h-[60vh] bg-gray-100 rounded-lg overflow-hidden",children:[e.jsxs(u,{ref:h,children:[e.jsx(p,{}),e.jsx(w,{}),e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[0,5,10],intensity:1})]}),N&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg max-w-xs text-center",children:[e.jsx("p",{className:"text-red-600 mb-2",children:N}),e.jsx("button",{onClick:()=>v(null),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Try Again"})]})})]}),e.jsx("div",{className:"mt-4 flex justify-center space-x-4",children:e.jsx("button",{onClick:()=>{c(!0),setTimeout(()=>{if(h.current){try{const e=h.current.toDataURL("image/jpeg");n(e)}catch(e){v("Failed to capture image. Please try again.")}c(!1)}},300)},disabled:o||!f,className:"p-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50",children:e.jsx(a,{className:"w-6 h-6"})})}),i&&e.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded overflow-hidden",children:e.jsx("img",{src:"https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400",alt:i.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:i.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[i.category," • ",i.color]})]})]})}),e.jsxs("div",{className:"mt-4 flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(r,{className:"w-3 h-3 mr-1 text-purple-600"}),e.jsx("span",{children:"Powered by AR technology"})]}),e.jsxs("button",{onClick:()=>m(!0),className:"text-purple-600 hover:text-purple-800 flex items-center",children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),e.jsx("span",{children:"Show tips"})]})]})]})},b=({isOpen:u,onClose:p,wardrobeItem:j})=>{const[y,b]=x.useState("upload"),[N,v]=x.useState(null),[w,k]=x.useState(null),[C,S]=x.useState(!1),[P,T]=x.useState(!1),[F,A]=x.useState(null),[R,I]=x.useState(!1),[O,U]=x.useState(!1),[L,M]=x.useState(!1),[z,D]=x.useState(!1),E=x.useRef(null);x.useRef(null);const G=x.useRef(null);x.useEffect(()=>{!u||"upload"!==y&&"camera"!==y||(async()=>{try{A(null),D(!0),await new Promise(e=>setTimeout(e,1e3)),I(!0)}catch(e){A("Failed to load face detection models. Please try the AR option instead.")}finally{D(!1)}})()},[u,y]);const{getRootProps:B,getInputProps:V,isDragActive:Y}=h({accept:{"image/*":[".jpeg",".jpg",".png"]},maxSize:5242880,maxFiles:1,onDrop:e=>{e.length>0&&J(e[0])},onDropRejected:e=>{var s,t;const a=e[0];"file-too-large"===(null==(s=a.errors[0])?void 0:s.code)?A("File size must be less than 5MB"):"file-invalid-type"===(null==(t=a.errors[0])?void 0:t.code)?A("Only image files are allowed"):A("Invalid file")}}),J=e=>{A(null);const s=new FileReader;s.onload=async e=>{var s;(null==(s=e.target)?void 0:s.result)&&(v(e.target.result),await W(e.target.result))},s.onerror=()=>{A("Failed to read file")},s.readAsDataURL(e)},W=async e=>{S(!0),U(!1);try{await new Promise(e=>setTimeout(e,1500)),U(!0),await Z(e)}catch(s){A("Failed to process image. Please try again or use AR mode."),S(!1)}},Z=async e=>{if(!j)return A("No wardrobe item selected"),void S(!1);try{await new Promise(e=>setTimeout(e,1e3)),k(e)}catch(s){A("Failed to apply virtual try-on. Please try again or use AR mode.")}finally{S(!1)}},$=()=>{if(w){const e=document.createElement("textarea");e.value=w,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),alert("Image copied to clipboard!")}},q=()=>{v(null),k(null),U(!1),A(null)},H=()=>{q(),p()};return e.jsx(i,{children:u&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx(s.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity",onClick:H}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs(s.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"relative inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center px-6 py-4 bg-gradient-to-r from-purple-50 to-pink-50 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-100 to-pink-100 rounded-full p-2",children:e.jsx(a,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Photo Try-On"}),e.jsx("p",{className:"text-sm text-gray-600",children:j?`Try on: ${j.name}`:"Upload a selfie to try on items"})]})]}),e.jsx("button",{type:"button",onClick:H,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(t,{size:20})})]}),e.jsxs("div",{className:"px-6 py-4",children:[F&&e.jsx(s.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:F})}),z&&"ar"!==y?e.jsx("div",{className:"flex justify-center py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading face detection models..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit mx-auto",children:[e.jsxs("button",{onClick:()=>{b("upload"),q()},className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("upload"===y?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(n,{className:"inline w-4 h-4 mr-2"}),"Upload Photo"]}),e.jsxs("button",{onClick:()=>{b("camera"),q()},className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("camera"===y?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(a,{className:"inline w-4 h-4 mr-2"}),"Take Selfie"]}),e.jsxs("button",{onClick:()=>{b("ar"),q()},className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+("ar"===y?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[e.jsx(r,{className:"inline w-4 h-4 mr-2"}),"AR Try-On"]})]}),"ar"===y?e.jsx(f,{wardrobeItem:j,onCapture:e=>{v(e),k(e),U(!0),S(!1)}}):N?e.jsxs("div",{className:"space-y-6",children:[C&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Processing your image..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a moment"})]})}),O&&!C&&e.jsxs("div",{className:"bg-green-50 rounded-lg p-3 border border-green-200 flex items-start",children:[e.jsx(o,{className:"w-5 h-5 text-green-600 mr-2 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Face detected successfully!"}),e.jsx("p",{className:"text-xs text-green-700",children:"Your virtual try-on is ready below."})]})]}),!C&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Your Photo"}),e.jsx("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:N,alt:"Your selfie",className:"w-full object-contain"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Virtual Try-On"}),e.jsx("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:w?e.jsx("img",{src:w,alt:"Virtual try-on",className:"w-full object-contain"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center p-6 text-center",children:e.jsx("p",{className:"text-gray-500",children:"Processing your image..."})})})]})]}),!C&&e.jsxs("div",{className:"flex flex-wrap justify-center gap-3",children:[e.jsxs("button",{onClick:q,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(c,{className:"w-4 h-4 mr-2"}),"Try Another Photo"]}),w&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{if(w){const e=document.createElement("a");e.href=w,e.download=`styleai-tryon-${(new Date).getTime()}.jpg`,document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2"}),"Save Image"]}),e.jsxs("button",{onClick:()=>{w&&(navigator.share?fetch(w).then(e=>e.blob()).then(e=>{const s=new File([e],"styleai-tryon.jpg",{type:"image/jpeg"});navigator.share({title:"My StyleAI Virtual Try-On",text:"Check out my virtual try-on with StyleAI!",files:[s]}).catch(e=>{$()})}):$())},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[e.jsx(m,{className:"w-4 h-4 mr-2"}),"Share"]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>M(!L),className:"text-sm text-purple-600 hover:text-purple-800 flex items-center mx-auto",children:[e.jsx(l,{className:"w-4 h-4 mr-1"}),L?"Hide tips":"Show tips for best results"]})}),e.jsx(i,{children:L&&e.jsxs(s.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Tips for best results:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 list-disc pl-5",children:[e.jsx("li",{children:"Use a well-lit photo with a neutral background"}),e.jsx("li",{children:"Face the camera directly with your full face visible"}),e.jsx("li",{children:"Avoid wearing items similar to what you're trying on"}),e.jsx("li",{children:"Keep a neutral expression for best face detection"}),e.jsx("li",{children:"For tops, wear a plain t-shirt or tank top"})]})]})}),"upload"===y&&e.jsxs("div",{...B(),className:"border-2 border-dashed rounded-lg px-6 pt-5 pb-6 flex flex-col items-center justify-center h-64 cursor-pointer transition-all "+(Y?"border-purple-400 bg-purple-50":"border-gray-300 hover:border-purple-400 hover:bg-gray-50"),children:[e.jsx("input",{...V(),ref:G}),e.jsxs("div",{className:"space-y-2 text-center",children:[e.jsx(n,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-purple-600 hover:text-purple-500",children:"Upload a selfie"})," ","or drag and drop"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"PNG, JPG up to 5MB"})]})]}),"camera"===y&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative w-full max-w-md h-64 bg-gray-100 rounded-lg overflow-hidden",children:[e.jsx(g,{ref:E,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:"user",width:640,height:480},onUserMedia:()=>T(!0),onUserMediaError:e=>{A("Failed to access camera. Please check permissions or try uploading a photo instead.")},className:"w-full h-full object-cover"}),!P&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-800/50",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-white"})})]}),e.jsxs("button",{onClick:async()=>{if(E.current){const e=E.current.getScreenshot();e?(v(e),await W(e)):A("Failed to capture image")}},disabled:!P,className:"mt-4 px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg disabled:opacity-50",children:[e.jsx(a,{className:"w-5 h-5 inline mr-2"}),"Capture Selfie"]})]})]}),j&&"ar"!==y&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Selected Item"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:"https://images.pexels.com/photos/996329/pexels-photo-996329.jpeg?auto=compress&cs=tinysrgb&w=400",alt:j.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:j.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[j.category," • ",j.color]})]})]})]}),"ar"!==y&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Powered by AI"}),e.jsxs("div",{className:"flex items-center text-purple-600",children:[e.jsx(r,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"text-xs font-medium",children:"StyleAI Technology"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Our advanced AI uses face detection and image processing to create realistic virtual try-ons. Results may vary based on lighting, angle, and image quality."})]})]})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 flex justify-end space-x-3",children:e.jsx("button",{type:"button",onClick:H,className:"px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 transition-colors",children:"Close"})})]})]})})})};export{b as P};
